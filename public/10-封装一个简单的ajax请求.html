<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>10-封装一个简单的ajax请求</title>
</head>
<body>
<script>
    // 封装一个ajax函数 只接受类型为get和post
    function ajax(options) {
        var xhr = new XMLHttpRequest();
        // 拼接参数, 将json转化成字符串格式
        var params = '';
        for (var attr in options.data){
           params += attr + '=' + options.data[attr] + '&';
        }
        // 去掉末尾的&符号
        params = params.substring(0, params.length - 1);
        // 拼接url
        if(options.type == 'get'){
            options.url = options.url + '?' + params;
        }
        // 建立连接
        xhr.open(options.type, options.url);

        if (options.type == 'post'){
            // 拿到请求头类型
            var contentType = options.header['Content-Type'];
            // 设置类型
            xhr.setRequestHeader('Content-Type', contentType);
            // 选择发送数据格式
            if(contentType == 'application/json'){
                xhr.send(JSON.stringify(options.data));
            }else {
                xhr.send(params);
            }

        }else {
            xhr.send();
        }
        // 当xhr对象接受完响应数据后触发
        xhr.onload = function () {
            console.log(xhr.responseText);
            options.success(xhr.responseText);
        }

    }

    ajax({
        type: 'get',
        url: 'http://localhost:3000/cache',
        success: function (data) {
            alert("这是success函数响应结果:" + data);
        }
    });

    ajax({
        type: 'post',
        url: 'http://localhost:3000/post',
        data: {
            name: 'coder-xsj',
            age: 21,
        },
        header: {
            'Content-Type': 'application/json',
        },
        success: function (data) {
            alert("这是success函数响应结果:" + data);
        }
    });


</script>
</body>
</html>